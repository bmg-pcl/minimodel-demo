<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Model Viewer</title>
  
  <!-- Milligram CSS and Barlow Condensed font -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600&display=swap" rel="stylesheet">
  
  <!-- Model Viewer JS -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  
  <!-- Custom Styling -->
  <style>
    /* Dark mode styling */
    body {
      font-family: 'Barlow Condensed', sans-serif;
      background-color: #000;
      color: #eee;
      display: flex;
      margin: 0;
      height: 100vh;
      position: relative;
    }

    /* Main content styling */
    main {
      display: flex;
      flex-direction: column;
      width: 100%;
      align-items: flex-start;
      padding-left: 1em;
      position: relative;
    }

    /* CRT-style Log Messages with Full-Area Scanline Effect */
    #terminal-log {
      font-family: 'Courier New', monospace;
      color: #0f0;
      font-size: 1em;
      position: absolute;
      top: 1em;
      left: 1em;
      opacity: 1;
      transition: opacity 1s ease;
      z-index: 20;
      white-space: pre-wrap;
      line-height: 1.4;
    }

    main::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(15, 255, 0, 0.1),
        rgba(15, 255, 0, 0.1) 1px,
        transparent 1px,
        transparent 3px
      );
      animation: scan 0.1s steps(20) infinite;
      pointer-events: none;
    }

    /* Scanline animation */
    @keyframes scan {
      0% {
        transform: translateY(-100%);
      }
      100% {
        transform: translateY(100%);
      }
    }

    /* Model Viewer Styling with Fade-in */
    model-viewer {
      width: 100%;
      height: 100vh;
      outline: none;
      background-color: #000;
      opacity: 0; /* Start hidden */
      transition: opacity 1s ease; /* Smooth fade-in effect */
    }

    /* Sidebar Styling with Slide Animation */
    #sidebar {
      position: absolute;
      top: 0;
      right: 0;
      width: 20%;
      max-width: 300px;
      min-width: 200px;
      height: 100vh;
      padding: 1em;
      background: #000;
      color: #0f0;
      border-left: 2px solid #333;
      display: none; /* Initially hidden */
      flex-direction: column;
      z-index: 10;
      font-family: 'Barlow Condensed', sans-serif; /* Sidebar font */
    }

    /* Sidebar visible state */
    #sidebar.visible {
      display: flex;
    }

    /* Close Sidebar Button */
    #close-sidebar {
      align-self: flex-end;
      background: #000;
      color: #0f0;
      border: none;
      cursor: pointer;
      font-size: 1em;
      margin-bottom: 1em;
    }

    /* No JSON loaded message */
    #no-json-message {
      font-size: 1em;
      color: #0f0;
      padding: 1em;
      background: #000;
      font-family: 'Barlow Condensed', sans-serif;
      text-align: left;
    }

    /* Toggle Sidebar Button */
    #toggle-sidebar {
      position: absolute;
      top: 1em;
      right: 1em;
      padding: 0.5em;
      font-size: 1.5em;
      background-color: #333;
      color: #0f0;
      border: none;
      cursor: pointer;
      z-index: 10;
      text-align: center;
      width: 2em;
      height: 2em;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Minimalist Section Header and Content Styling */
    .collapsible {
      cursor: pointer;
      padding: 0.5em;
      font-weight: bold;
      color: #0f0; /* Green header */
      background: #000;
      border: none;
      text-align: left;
    }

    .content {
      display: none;
      padding: 0.5em;
      color: #ccc; /* Light grey for readability */
      background: #000;
      border: none;
      margin-bottom: 1em;
      font-family: 'Barlow Condensed', sans-serif; /* Sidebar font */
    }

    /* Settings Tab Styling */
    #settings-tab {
      margin-top: auto;
      display: flex;
      align-items: center;
      cursor: pointer;
      color: #0f0;
    }

    #settings-content {
      display: none;
    }

    /* Custom Icon */
    .settings-icon {
      margin-right: 0.5em;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <main>
    <!-- Model Viewer Component -->
    <model-viewer id="model-viewer" src="" auto-rotate camera-controls></model-viewer>

    <!-- Console-style Log Messages -->
    <div id="terminal-log">INDUSTRIAL DATA</div><br>
  </main>

  <!-- Sidebar Toggle Button -->
  <button id="toggle-sidebar" onclick="toggleSidebar()">P</button>

  <!-- Sidebar with Collapsible Properties and Settings -->
  <div id="sidebar">
    <button id="close-sidebar" onclick="toggleSidebar()">Close</button>

    <!-- No JSON Loaded Message -->
    <div id="no-json-message">
      Industrial Minimodels.<br>
      No properties loaded for this model; dummy values below.
    </div>

    <!-- Property Sections -->
    <button class="collapsible">Geometry</button>
    <div class="content" id="geometry-content">
      <p></p>
    </div>

    <button class="collapsible">Materials</button>
    <div class="content" id="materials-content">
      <p></p>
    </div>

    <button class="collapsible">Metadata</button>
    <div class="content" id="metadata-content">
      <p></p>
    </div>

    <!-- Links: Docs Section -->
    <button class="collapsible">Links: Docs</button>
    <div class="content" id="doc-references-content">
      <p></p>
    </div>

    <!-- Links: Progress Section -->
    <button class="collapsible">Links: Progress</button>
    <div class="content" id="progress-links-content">
      <p></p>
    </div>

    <!-- Links: Quality Section -->
    <button class="collapsible">Links: Quality</button>
    <div class="content" id="quality-links-content">
      <p></p>
    </div>

    <!-- Links: Other Section -->
    <button class="collapsible">Links: Other</button>
    <div class="content" id="other-links-content">
      <p></p>
    </div>

    <!-- Settings Tab -->
    <div id="settings-tab" onclick="toggleSettings()">
      <span class="settings-icon">⚙️</span>
      <span>Settings</span>
    </div>
    <div id="settings-content">
      <label for="color-mode">Color Mode:</label>
      <select id="color-mode" onchange="updateColorMode()">
        <option value="full">Full Color</option>
        <option value="greyscale">Greyscale</option>
        <option value="limited">Limited Color</option>
      </select>
    </div>
  </div>

  <!-- JavaScript for Collapsible, Settings, JSON Loading, and Logging -->
  <script>
    // Configurable file URLs and delay
    const glbFileUrl = 'https://bmg-pcl.github.io/minimodel-demo/Mini-Model-2-7213-74-3500-S02.glb';  // Default GLB file URL
    const jsonFileUrl = '';  // Set JSON file path here if available
    const messageDelay = 750; // Delay in ms

    // Terminal log messages and timing, prefixed with "> "
    const logMessages = ["> WELCOME", "> LOADING VIEWER", "> LOADING MINIMODEL", "> COMPLETE"];
    const terminalLog = document.getElementById('terminal-log');
    const modelViewer = document.getElementById('model-viewer');

    // Display each log message sequentially
    let currentMessageIndex = 0;
    function showNextLogMessage() {
      terminalLog.textContent += `\n${logMessages[currentMessageIndex]}`;
      currentMessageIndex += 1;
      if (currentMessageIndex < logMessages.length) {
        setTimeout(showNextLogMessage, messageDelay);
      } else {
        setTimeout(() => {
          terminalLog.style.opacity = 0;
          modelViewer.style.opacity = 1; // Fade in the model
        }, messageDelay);
      }
    }
    showNextLogMessage();

    // Set GLB file URL for the model-viewer
    modelViewer.src = glbFileUrl;

    // Load JSON file if available
    if (jsonFileUrl) {
      fetch(jsonFileUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('JSON not available');
          }
          return response.json();
        })
        .then(data => {
          populateSidebar(data);
          document.getElementById('no-json-message').style.display = 'none';
        })
        .catch(() => {
          console.warn('No JSON file found. Sidebar will only show default message.');
          populateWithDummyData();
        });
    } else {
      populateWithDummyData();
    }

    // Toggle Sidebar Visibility with Slide
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('visible');
    }

    // Populate with dummy data if no properties are loaded
    function populateWithDummyData() {
      document.getElementById('geometry-content').innerHTML = "<p>Prop1: Value1<br>Prop2: Value2</p>";
      document.getElementById('materials-content').innerHTML = "<p>Prop1: Value1<br>Prop2: Value2</p>";
      document.getElementById('metadata-content').innerHTML = "<p>Prop1: Value1<br>Prop2: Value2</p>";
      document.getElementById('doc-references-content').innerHTML = "<p>Link1<br>Link2</p>";
      document.getElementById('progress-links-content').innerHTML = "<p>Link1<br>Link2</p>";
      document.getElementById('quality-links-content').innerHTML = "<p>Link1<br>Link2</p>";
      document.getElementById('other-links-content').innerHTML = "<p>Link1<br>Link2</p>";
    }

    // Populate the sidebar with JSON data
    function populateSidebar(data) {
      if (data.geometry) document.getElementById('geometry-content').innerHTML = `<p>${data.geometry}</p>`;
      if (data.materials) document.getElementById('materials-content').innerHTML = `<p>${data.materials}</p>`;
      if (data.metadata) document.getElementById('metadata-content').innerHTML = `<p>${data.metadata}</p>`;
      if (data.docReferences) document.getElementById('doc-references-content').innerHTML = data.docReferences.map(link => `<p><a href="${link}" target="_blank">${link}</a></p>`).join('');
      if (data.progressLinks) document.getElementById('progress-links-content').innerHTML = data.progressLinks.map(link => `<p><a href="${link}" target="_blank">${link}</a></p>`).join('');
      if (data.qualityLinks) document.getElementById('quality-links-content').innerHTML = data.qualityLinks.map(link => `<p><a href="${link}" target="_blank">${link}</a></p>`).join('');
      if (data.otherLinks) document.getElementById('other-links-content').innerHTML = data.otherLinks.map(link => `<p><a href="${link}" target="_blank">${link}</a></p>`).join('');
    }

    // Toggle Collapsible Sections
    document.querySelectorAll('.collapsible').forEach(button => {
      button.addEventListener('click', () => {
        const content = button.nextElementSibling;
        content.style.display = content.style.display === 'block' ? 'none' : 'block';
      });
    });

    // Toggle Settings Content
    function toggleSettings() {
      const settingsContent = document.getElementById('settings-content');
      settingsContent.style.display = settingsContent.style.display === 'block' ? 'none' : 'block';
    }

    // Update Color Mode
    function updateColorMode() {
      const colorMode = document.getElementById('color-mode').value;
      switch (colorMode) {
        case 'greyscale':
          modelViewer.style.filter = 'grayscale(100%)';
          break;
        case 'limited':
          modelViewer.style.filter = 'contrast(80%) saturate(50%)';
          break;
        default:
          modelViewer.style.filter = 'none';
      }
    }
  </script>

</body>
</html>
